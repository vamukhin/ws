let MESSAGE_HANDLE_TYPES,onFakeAuthHandler,onNewChatMessage;_ada‍.x([["onMessageHandler",()=>onMessageHandler]]);_ada‍.w("./on-message-handle-types",[["MESSAGE_HANDLE_TYPES",["MESSAGE_HANDLE_TYPES"],function(v){MESSAGE_HANDLE_TYPES=v}]]);_ada‍.w("./handlers/on-fake-auth",[["onFakeAuthHandler",["onFakeAuthHandler"],function(v){onFakeAuthHandler=v}]]);_ada‍.w("./handlers/on-new-message",[["onNewChatMessage",["onNewChatMessage"],function(v){onNewChatMessage=v}]]);



const actionHandlerConfig = {
    [MESSAGE_HANDLE_TYPES.auth]: onFakeAuthHandler,
    [MESSAGE_HANDLE_TYPES.chatMessage]: onNewChatMessage,
}

       function onMessageHandler(message){
    const webSocket = this;
    _ada‍.g.console.log(message)
    
    const {type, payload} = JSON.parse(message);
    const handler =  actionHandlerConfig[type];
    if(handler) {
        console.log("handle found")
        const thisForHandler = {
            type, webSocket
        }
        handler.call(thisForHandler, payload)
    } else {
        console.log("handle error")
        const errorObject = JSON.stringify({
            type: MESSAGE_HANDLE_TYPES.error,
            payload: {
                message: `no handler ${type} is registered`
            }
        })

        webSocket.send(errorObject)
    }
}