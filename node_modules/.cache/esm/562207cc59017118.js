let fakeDataBase;_590‍.x([["onNewChatMessage",()=>onNewChatMessage]]);_590‍.w("../../../fake-data-base",[["fakeDataBase",["fakeDataBase"],function(v){fakeDataBase=v}]]);

       function onNewChatMessage(payload){    
    const {webSocket, type} = this;
    const {messageText, userId, userName} = payload;
    const message = {
        messageText, userId, userName
    }
    const newMessageWithId = fakeDataBase.addNewMessage(message);
    const lastMessageJson = JSON.stringify({
        type,
        payload: newMessageWithId
    })
    fakeDataBase.users.forEach(loggedUser => loggedUser.webSocket.send(lastMessageJson))

}